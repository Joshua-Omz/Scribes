{
	"name": "Scribes Backend",
	"dockerComposeFile": "docker-compose.yml",
	"service": "app",
	"workspaceFolder": "/workspace",
	
	// Features to install in the container
	"features": {
		"ghcr.io/devcontainers/features/python:1": {
			"version": "3.11",
			"installTools": true
		},
		"ghcr.io/devcontainers/features/git:1": {},
		"ghcr.io/devcontainers/features/github-cli:1": {}
	},

	// Configure tool-specific properties
	"customizations": {
    "vscode": {
        "extensions": [
            "ms-python.python",
            "ms-python.vscode-pylance",
            "astral-sh.ruff",             // Updated ID (Replaces Black, Isort, Flake8)
            "tamasfe.even-better-toml",
            "redhat.vscode-yaml",
            "ms-azuretools.vscode-docker",
            "streetsidesoftware.code-spell-checker",
            "eamodio.gitlens",
            "github.copilot"
        ],
        "settings": {
            "python.defaultInterpreterPath": "/usr/local/bin/python",
            "python.testing.pytestEnabled": true,
            "python.testing.unittestEnabled": false,
            "python.testing.pytestArgs": ["tests"],
            
            // Configure Ruff as the default formatter for Python
            "[python]": {
                "editor.defaultFormatter": "astral-sh.ruff",
                "editor.formatOnSave": true,
                "editor.codeActionsOnSave": {
                    "source.organizeImports": "explicit"
                }
            }
        }
    }
},

	// Use 'forwardPorts' to make a list of ports inside the container available locally
	"forwardPorts": [
		8000,  // FastAPI
		5432,  // PostgreSQL
		6379   // Redis
	],

	// Port attributes for better port management
	"portsAttributes": {
		"8000": {
			"label": "FastAPI Application",
			"onAutoForward": "notify"
		},
		"5432": {
			"label": "PostgreSQL Database",
			"onAutoForward": "silent"
		},
		"6379": {
			"label": "Redis",
			"onAutoForward": "silent"
		}
	},

	// Set environment variables
	"containerEnv": {
		"PYTHONUNBUFFERED": "1",
		"PYTHONDONTWRITEBYTECODE": "1"
	},

	// Commands to run after the container is created
	"postCreateCommand": "pip install --upgrade pip && pip install -r requirements.txt && pre-commit install || true",

	// Commands to run after the container starts
	"postStartCommand": "echo 'Container started. Run: uvicorn app.main:app --reload --host 0.0.0.0 --port 8000'",

	// Use 'postAttachCommand' to run commands when VS Code attaches to the container
	"postAttachCommand": {
		"server": "echo 'Ready to develop! Database: postgres@db:5432/scribes_db, Redis: redis:6379'"
	},

	// Comment out to connect as root instead
	"remoteUser": "vscode"
}
